# 인증 전달 구조: React → Backend → Sub-System (AES + IV 방식)

![인증 시퀀스 다이어그램](./auth-aes-iv.png)

## 설명

React 화면에서 사용자가 `Sub-System`으로 이동하는 버튼을 클릭하면, React는 `Backend`에 암호화된 인증 토큰을 요청합니다.  
Backend는 JWT를 생성한 후, AES 방식으로 암호화하고, IV 값을 동적으로 생성하여 React에 전달합니다.  
React는 해당 데이터를 쿼리스트링으로 구성하여 `Sub-System`으로 이동하고,  
Sub-System은 `crypto-js`를 이용해 복호화한 후 JSON 형태로 파싱하여 인증 정보를 확인하거나 객체로 매핑해 사용합니다.

---

## 구성 요소

- **User**: 시스템 사용자
- **React**: 프론트엔드 UI, 인증 토큰 요청 및 전달
- **Backend**: JWT 생성, AES 암호화 및 IV 동적 생성
- **Sub-System**: 암호화된 토큰 복호화 및 인증 처리

---

## 장점

- ✅ **서버 간 인증 전달의 보안성 향상**  
  - AES 대칭키 + IV 사용으로 토큰이 중간에 탈취되어도 쉽게 해독하기 어려움  
  - Backend에서 암호화를 수행함으로써 클라이언트에 암호화 키를 노출하지 않음

- ✅ **JWT 구조 확장성 유지**  
  - Backend에서 JWT를 생성하므로 Claim 정보를 자유롭게 추가하거나 제한 가능

- ✅ **Sub-System은 독립적인 인증 처리 가능**  
  - 메인 시스템과 직접적으로 연동하지 않고도 전달받은 데이터로 자체 인증 처리 가능

- ✅ **단일 로그인 기반 연동에 적합**  
  - 메인 시스템에서 로그인한 사용자의 정보를 안전하게 하위 시스템으로 전달 가능

---

## 단점

- ⚠️ **AES 키 유출 시 전체 인증 구조 위험**  
  - 암복호화 키가 유출되면 모든 Sub-System 인증 흐름이 노출될 위험 있음  
  - 키 관리 및 보안에 매우 민감

- ⚠️ **쿼리스트링에 민감 정보 포함**  
  - 암호화되어 있더라도 URL에 인증 관련 데이터를 노출하는 구조는 보안상 우려  
  - HTTPS를 강제하고 TTL(Time To Live) 및 1회성 토큰으로 제한 필요

- ⚠️ **Sub-System 구현 복잡도 증가**  
  - `crypto-js` 기반 복호화 및 JWT 파싱/검증 로직을 각 Sub-System이 구현해야 함

- ⚠️ **시간 동기화 이슈**  
  - JWT 내 시간 기반 클레임(`exp`, `iat` 등)이 있을 경우 서버 간 시간 오차가 문제될 수 있음

---

## 결론

이 방식은 **보안성과 독립성**을 동시에 확보하려는 시스템에 적합합니다.  
단, **암호화 키 관리**와 **쿼리스트링 보안 강화**, **Sub-System 내 인증 처리의 표준화**가 반드시 선행되어야 합니다.
